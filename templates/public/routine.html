{% extends 'base.html' %}

{% block head_extra %}
<style>
    .routine-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .filter-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }
    
    .filter-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #4b5563;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .filter-select {
        width: 100%;
        padding: 0.625rem 0.875rem;
        border: 1.5px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
        color: #1f2937;
        background-color: #f9fafb;
        transition: all 0.2s;
    }
    
    .filter-select:focus {
        outline: none;
        border-color: #667eea;
        background-color: white;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .filter-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.625rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 6px -1px rgba(102, 126, 234, 0.3);
    }
    
    .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px -1px rgba(102, 126, 234, 0.4);
    }
    
    .reset-btn {
        background: white;
        color: #6b7280;
        padding: 0.625rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        border: 1.5px solid #e5e7eb;
        cursor: pointer;
        transition: all 0.2s;
        margin-left: 0.75rem;
    }
    
    .reset-btn:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }
    
    .routine-table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .routine-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }
    
    .routine-table thead {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .routine-table th {
        padding: 1rem;
        text-align: left;
        font-size: 0.875rem;
        font-weight: 600;
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .routine-table tbody tr {
        border-bottom: 1px solid #f3f4f6;
        transition: background-color 0.2s;
    }
    
    .routine-table tbody tr:hover {
        background-color: #f9fafb;
    }
    
    .routine-table tbody tr:last-child {
        border-bottom: none;
    }
    
    .routine-table td {
        padding: 1rem;
        font-size: 0.875rem;
        color: #374151;
    }
    
    .day-badge {
        display: inline-block;
        padding: 0.375rem 0.875rem;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.8125rem;
    }
    
    .day-sunday { background: #fef3c7; color: #92400e; }
    .day-monday { background: #dbeafe; color: #1e40af; }
    .day-tuesday { background: #e0e7ff; color: #4338ca; }
    .day-wednesday { background: #fce7f3; color: #9f1239; }
    .day-thursday { background: #d1fae5; color: #065f46; }
    .day-friday { background: #fef3c7; color: #92400e; }
    .day-saturday { background: #f3e8ff; color: #6b21a8; }
    
    .time-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.375rem 0.75rem;
        background: #f3f4f6;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.8125rem;
        color: #1f2937;
    }
    
    .time-badge i {
        margin-right: 0.375rem;
        color: #6b7280;
        font-size: 0.75rem;
    }
    
    .class-badge {
        display: inline-block;
        padding: 0.375rem 0.875rem;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.8125rem;
    }
    
    .subject-text {
        font-weight: 600;
        color: #1f2937;
    }
    
    .teacher-text {
        color: #6b7280;
        display: flex;
        align-items: center;
    }
    
    .teacher-text i {
        margin-right: 0.5rem;
        color: #9ca3af;
    }
    
    .room-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.375rem 0.75rem;
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        color: #166534;
        border-radius: 6px;
        font-weight: 500;
        font-size: 0.8125rem;
    }
    
    .room-badge i {
        margin-right: 0.375rem;
        font-size: 0.75rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: #9ca3af;
    }
    
    .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #6b7280;
        margin-bottom: 0.5rem;
    }
    
    .empty-state p {
        font-size: 0.875rem;
    }
    
    @media (max-width: 768px) {
        .routine-header {
            padding: 1.5rem;
        }
        
        .filter-card {
            padding: 1rem;
        }
        
        .routine-table {
            font-size: 0.8125rem;
        }
        
        .routine-table th,
        .routine-table td {
            padding: 0.75rem 0.5rem;
        }
        
        .filter-btn,
        .reset-btn {
            width: 100%;
            margin-left: 0;
            margin-top: 0.5rem;
        }
    }
</style>
{% endblock %}

{% block scripts_extra %}
<script>
    // Auto-submit form when any filter dropdown changes
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('filterForm');
        const selects = form.querySelectorAll('.auto-submit');
        
        selects.forEach(select => {
            select.addEventListener('change', function() {
                form.submit();
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="routine-header">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold mb-2">Class Routine</h1>
            <p class="text-blue-100 text-sm">View and filter the school schedule by day, class, teacher, or subject</p>
        </div>
        <i class="fas fa-calendar-alt text-5xl opacity-20 hidden md:block"></i>
    </div>
</div>

<!-- Filter Section -->
<div class="filter-card">
    <div class="flex items-center mb-4">
        <i class="fas fa-filter text-purple-600 mr-2"></i>
        <h2 class="text-lg font-semibold text-gray-800">Filter Routine</h2>
    </div>
    
    <form method="get" id="filterForm">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
            <!-- Day Filter -->
            <div>
                <label class="filter-label">
                    <i class="fas fa-calendar-day mr-1"></i>Day
                </label>
                <select name="day" class="filter-select auto-submit">
                    <option value="all">All Days</option>
                    {% for day in days %}
                    <option value="{{ day }}" {% if selected_day == day %}selected{% endif %}>{{ day }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Class Filter -->
            <div>
                <label class="filter-label">
                    <i class="fas fa-graduation-cap mr-1"></i>Class
                </label>
                <select name="class_id" class="filter-select auto-submit">
                    <option value="all">All Classes</option>
                    {% for cls in classes %}
                    <option value="{{ cls.id }}" {% if selected_class|int == cls.id %}selected{% endif %}>{{ cls.name }} - {{cls.section}}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Teacher Filter -->
            <div>
                <label class="filter-label">
                    <i class="fas fa-chalkboard-teacher mr-1"></i>Teacher
                </label>
                <select name="teacher_id" class="filter-select auto-submit">
                    <option value="all">All Teachers</option>
                    {% for teacher in teachers %}
                    <option value="{{ teacher.id }}" {% if selected_teacher|int == teacher.id %}selected{% endif %}>{{ teacher.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Subject Filter -->
            <div>
                <label class="filter-label">
                    <i class="fas fa-book mr-1"></i>Subject
                </label>
                <select name="subject_id" class="filter-select auto-submit">
                    <option value="all">All Subjects</option>
                    {% for subject in subjects %}
                    <option value="{{ subject.id }}" {% if selected_subject|int == subject.id %}selected{% endif %}>{{ subject.name }}  -  ({{subject.code}})</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <!-- Reset Button -->
        <div class="flex justify-end">
            <a href="{{ url_for('public.routine') }}" class="reset-btn">
                <i class="fas fa-redo mr-2"></i>Reset Filters
            </a>
        </div>
    </form>
</div>

<!-- Routine Table -->
<div class="routine-table-container">
    {% if routines %}
    <div class="overflow-x-auto">
        <table class="routine-table">
            <thead>
                <tr>
                    <th><i class="fas fa-calendar mr-2"></i>Day</th>
                    <th><i class="fas fa-clock mr-2"></i>Time</th>
                    <th><i class="fas fa-graduation-cap mr-2"></i>Class</th>
                    <th><i class="fas fa-book mr-2"></i>Subject</th>
                    <th><i class="fas fa-user-tie mr-2"></i>Teacher</th>
                    <th><i class="fas fa-door-open mr-2"></i>Room</th>
                </tr>
            </thead>
            <tbody>
                {% for routine in routines %}
                <tr>
                    <td>
                        <span class="day-badge day-{{ routine.day.lower() }}">{{ routine.day }}</span>
                    </td>
                    <td>
                        <span class="time-badge">
                            <i class="fas fa-clock"></i>
                            {{ routine.start_time.strftime('%H:%M') }} - {{ routine.end_time.strftime('%H:%M') }}
                        </span>
                    </td>
                    <td>
                        <span class="class-badge">{{ routine.subject.class_.name }}</span>
                    </td>
                    <td>
                        <span class="subject-text">{{ routine.subject.name }}</span>
                    </td>
                    <td>
                        <span class="teacher-text">
                            <i class="fas fa-user-circle"></i>
                            {{ routine.teacher.name }}
                        </span>
                    </td>
                    <td>
                        {% if routine.room %}
                        <span class="room-badge">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ routine.room }}
                        </span>
                        {% else %}
                        <span class="text-gray-400 text-sm">—</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-calendar-times"></i>
        <h3>No Routines Found. Today is holiday</h3>
        <p>Try adjusting your filters to see more results</p>
    </div>
    {% endif %}
</div>

{% endblock %}