{% extends "admin/base.html" %}
{% block content %}

<div class="container my-5">
    <div class="row">
        <!-- Add / Edit Form -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Add New Class</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin_bp.list_classes') }}"
                        onsubmit="return confirmAddClass();">
                        <input type="hidden" name="action" value="add">

                        <div class="mb-3">
                            <label for="name" class="form-label">Class Name</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="e.g. Class 8"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="section" class="form-label">Section</label>
                            <input type="text" class="form-control" id="section" name="section" placeholder="e.g. A"
                                required>
                        </div>

                        <div class="mb-3">
                            <label for="teacher" class="form-label">Assign Teacher</label>
                            <select class="form-select" id="teacher" name="teacher_id" required>
                                <option value="">Select Teacher</option>
                                {% for teacher in teachers %}
                                <option value="{{ teacher.id }}">{{ teacher.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Add Class</button>
                    </form>

                    <script>
                        function confirmAddClass() {
                            const name = document.getElementById('name').value.trim();
                            const section = document.getElementById('section').value.trim();
                            const teacher = document.getElementById('teacher').selectedOptions[0]?.text;

                            if (!name || !section || !teacher) {
                                alert("Please fill all fields before submitting.");
                                return false;
                            }

                            return confirm(
                                `Are you sure you want to add this class?\n\n` +
                                `Class: ${name}\nSection: ${section}\nTeacher: ${teacher}`
                            );
                        }
                    </script>

                </div>
            </div>
        </div>

        <!-- Class Table -->
        <div class="col-lg-8 col-md-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-semibold">All Classes</h5>
                </div>
                <div class="card-body table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-primary">
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Section</th>
                                <th>Teacher</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for cls in classes %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ cls.name }}</td>
                                <td>{{ cls.section }}</td>
                                <td>{{ cls.teacher.name if cls.teacher else 'N/A' }}</td>
                                <td>{{ cls.created_at.strftime('%d %b %Y') if cls.created_at else 'N/A' }}</td>
                                <td>
                                    <a href="{{ url_for('admin_bp.delete_class', class_id=cls.id) }}"
                                        class="btn btn-sm btn-danger"
                                        onclick="return confirm('Are you sure you want to delete this class?');">
                                        <i class="fa-solid fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="6" class="text-center text-muted py-4">No classes found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}