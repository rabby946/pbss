{% extends 'base.html' %}
{% block title %}{{ item.title }} : Palashbaria Secondary School{% endblock %}

{% block head_extra %}
<style>
    /* --- PSS GALLERY DETAIL DESIGN: COLOR CORRECTED AND REFINED --- */

    /* 1. Theme & Variables (Light/Professional Theme) */
    :root {
        --font-sans: 'Poppins', sans-serif; /* Using Poppins for a clean, modern look */
        --color-accent: #007bff; /* Primary Blue for actions/links */
        --color-text-dark: #1f2937; /* Dark text for readability */
        --color-text-light: #6b7280; /* Subtle text/descriptions */
        --card-bg: #ffffff; /* White card/content background */
        --card-border: #e5e7eb; /* Light border */
        --accent-glow: rgba(0, 123, 255, 0.2); /* Soft blue glow */
        --page-bg-subtle: #f4f7fa; /* Subtle page background */
    }
    
    /* Ensure the main content area has no conflicting margins/padding from base.html if possible */
    main > div {
        padding: 0 !important;
        max-width: none !important;
    }

    /* 2. Main Page Layout (Applied to the container itself) */
    .gallery-detail__container {
        max-width: 1200px; /* Slightly wider */
        margin: 0 auto; /* Remove top/bottom margin if base.html provides it */
        padding: 3rem 1.5rem;
        font-family: var(--font-sans);
        background-color: var(--page-bg-subtle); /* Define a background */
        min-height: 80vh;
    }
    
    /* 3. Hero Header Section */
    .gallery-detail__header {
        text-align: center;
        margin-bottom: 3.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid var(--card-border);
        background-color: var(--card-bg); /* Use white card background for header */
        padding-top: 2rem;
        border-radius: 12px 12px 0 0;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    .gallery-detail__title {
        font-size: 2.0rem;
        font-weight: 800;
        color: var(--color-text-dark); /* Changed from white to dark text */
        margin: 0 0 0.5rem 0;
        letter-spacing: -0.05em;
    }
    .gallery-detail__description {
        font-size: 1.1rem;
        color: var(--color-text-light); /* Subtle gray */
        max-width: 900px;
        margin: 0 auto 1.5rem auto;
        line-height: 1.6;
    }
    .gallery-detail__back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--color-accent);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.2s ease;
        margin-top: 1rem;
    }
    .gallery-detail__back-btn:hover {
        color: var(--color-text-dark);
    }

    /* 4. Responsive Image Grid */
    .gallery-detail__grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 2rem;
        background-color: var(--card-bg); /* Content area background */
        padding: 2rem;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }
    .gallery-detail__image-wrapper {
        position: relative;
        cursor: pointer;
        overflow: hidden;
        border-radius: 0.75rem;
        border: 1px solid var(--card-border);
        aspect-ratio: 4 / 3; /* Changed to a common photo aspect ratio (Landscape) */
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    /* Rest of image/hover styles remain good */
    .gallery-detail__image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        transition: transform 0.4s ease;
    }
    .gallery-detail__image-wrapper:hover .gallery-detail__image {
        transform: scale(1.05); /* Softened zoom */
    }
    .gallery-detail__overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /* Use a light gradient that fades out, preserving more image detail */
        background: linear-gradient(to top, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0) 50%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2.5rem;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .gallery-detail__image-wrapper:hover .gallery-detail__overlay {
        opacity: 1;
    }
    .gallery-detail__overlay i {
        /* Add a quick scale up effect to the icon on hover */
        transform: scale(0.8);
        transition: transform 0.3s ease;
    }
    .gallery-detail__image-wrapper:hover .gallery-detail__overlay i {
        transform: scale(1.1);
    }


    /* 5. The Professional Lightbox (Remains dark for focus) */
    .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95); /* Deeper black for better focus */
        backdrop-filter: blur(5px);
        z-index: 1000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .lightbox.is-visible {
        opacity: 1;
        visibility: visible;
    }
    /* Navigation buttons refined for visibility */
    .lightbox__close, .lightbox__nav {
        background: rgba(255, 255, 255, 0.1); /* Light background for contrast */
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        padding: 0.5rem;
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        opacity: 0.8;
        transition: opacity 0.2s ease, background-color 0.2s ease;
    }
    .lightbox__close:hover, .lightbox__nav:hover {
        background: rgba(255, 255, 255, 0.2);
        opacity: 1;
    }
    .lightbox__close {
        top: 20px;
        right: 20px;
        font-size: 2rem;
        line-height: 1;
        width: 50px;
        height: 50px;
    }
    .lightbox__nav {
        top: 50%;
        transform: translateY(-50%);
        padding: 0; /* Remove excess padding */
    }
    .lightbox__nav--prev { left: 20px; }
    .lightbox__nav--next { right: 20px; }
    
    .lightbox__counter {
        bottom: 20px;
        background: rgba(0,0,0,0.7);
        padding: 0.4rem 1rem;
    }

</style>
{% endblock %}

{% block content %}
<div class="gallery-detail__container">
    <div class="gallery-detail__header">
        <h2 class="gallery-detail__title">{{ item.title }}</h2>
        <p class="gallery-detail__description">{{ item.description if item.description else "A beautiful collection of photos capturing the essence of this event." }}</p>
        
        <a href="{{ url_for('public.gallery') }}" class="gallery-detail__back-btn">
            <i class="fas fa-arrow-left"></i> Back to All Galleries
        </a>
    </div>

    <div class="gallery-detail__grid">
        {% for img in item.images %}
            <div class="gallery-detail__image-wrapper">
                <img src="{{ img.strip() }}" alt="Gallery Image {{ loop.index }}" class="gallery-detail__image">
                <div class="gallery-detail__overlay">
                    <i class="fas fa-search-plus"></i>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<div class="lightbox" id="galleryLightbox">
    <button class="lightbox__close" title="Close (Esc)">&times;</button>
    <div class="lightbox__content">
        <img src="" alt="Enlarged gallery image" id="lightboxImage" class="lightbox__image">
        <div class="lightbox__counter" id="lightboxCounter"></div>
    </div>
    <button class="lightbox__nav lightbox__nav--prev" title="Previous (Left Arrow)">&#10094;</button>
    <button class="lightbox__nav lightbox__nav--next" title="Next (Right Arrow)">&#10095;</button>
</div>

{% endblock %}

{% block scripts_extra %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- PROFESSIONAL LIGHTBOX SCRIPT ---

    const galleryImages = document.querySelectorAll('.gallery-detail__image-wrapper');
    const lightbox = document.getElementById('galleryLightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxCounter = document.getElementById('lightboxCounter');
    const closeBtn = lightbox.querySelector('.lightbox__close');
    const prevBtn = lightbox.querySelector('.lightbox__nav--prev');
    const nextBtn = lightbox.querySelector('.lightbox__nav--next');

    // Create an array of image URLs from the grid
    const imageUrls = Array.from(galleryImages).map(wrapper => wrapper.querySelector('img').src);
    let currentIndex = 0;

    function showImage(index) {
        if (index < 0 || index >= imageUrls.length) {
            return; // Out of bounds
        }
        // Apply animation class before changing src, then remove it
        lightboxImage.classList.remove('animate-in');
        
        // Timeout ensures the class is added on the next frame after removal, forcing a re-animation
        setTimeout(() => {
            currentIndex = index;
            lightboxImage.src = imageUrls[currentIndex];
            lightboxCounter.textContent = `Image ${currentIndex + 1} of ${imageUrls.length}`;
            lightboxImage.classList.add('animate-in');
        }, 50); 
    }

    function openLightbox(index) {
        showImage(index);
        lightbox.classList.add('is-visible');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
    }

    function closeLightbox() {
        lightbox.classList.remove('is-visible');
        document.body.style.overflow = 'auto';
    }

    function showNextImage() {
        const nextIndex = (currentIndex + 1) % imageUrls.length; // Loop to start
        showImage(nextIndex);
    }

    function showPrevImage() {
        const prevIndex = (currentIndex - 1 + imageUrls.length) % imageUrls.length; // Loop to end
        showImage(prevIndex);
    }

    // --- EVENT LISTENERS ---

    // Open lightbox when an image is clicked
    galleryImages.forEach((wrapper, index) => {
        wrapper.addEventListener('click', () => openLightbox(index));
    });

    // Close lightbox events
    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => {
        // Close if the dark backdrop is clicked, but not the content inside it
        if (e.target === lightbox) {
            closeLightbox();
        }
    });

    // Navigation events
    nextBtn.addEventListener('click', showNextImage);
    prevBtn.addEventListener('click', showPrevImage);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (!lightbox.classList.contains('is-visible')) return;

        if (e.key === 'ArrowRight') {
            e.preventDefault(); // Prevent default browser scroll
            showNextImage();
        } else if (e.key === 'ArrowLeft') {
            e.preventDefault(); // Prevent default browser scroll
            showPrevImage();
        } else if (e.key === 'Escape') {
            closeLightbox();
        }
    });
});
</script>
{% endblock %}